<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESSEN SPIEL Preorder</title>
  <meta name="description" content="ESSEN SPIEL preorder page (English only)" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@100..900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <style>
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
    body {font-family: "Roboto Condensed", sans-serif;}
    .catalog-title { display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden; word-break: break-word;     /* 긴 단어/BR도 자연스럽게 줄바꿈 */}
    /* 모바일에서 스크롤 시 헤더 축소 */
    @media (max-width: 640px) {
    #siteHeader .header-inner {
        transition: padding 200ms ease;
    }
    #siteHeader.shrink .header-inner {
        padding-top: 0.20rem;   /* py-2 */
        padding-bottom: 0.20rem;
    }
    /* 부제 숨기기(줄 높이 절감) */
    #siteHeader.shrink #subtitle { display: none; }

    /* 브랜드명/로고 살짝 압축 (선택) */
    #siteHeader.shrink #brand-name { display: none; }
    #siteHeader.shrink #brandLogo { width: 100px !important; }

    /* 우상단 링크 위치도 살짝 올리기 */
    #siteHeader.shrink #headerLinks { top: 0.5rem; right: 0.5rem; }
    }
  </style>
</head>
<body class="min-h-screen bg-neutral-50">
  <header id="siteHeader" class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-neutral-200">
    <div class="header-inner max-w-5xl mx-auto px-4 py-4 flex items-center justify-between relative">
      <div class="flex items-center" style="display: block; margin: 0 auto;">
        <div id="brandLogo" style="width: 200px; margin: 0 auto;"><img src="https://ai.esmplus.com/magicbean7/Order/magicbean-logo.jpg"></div>
        <div style="text-align: center;">
          <h1 class="text-xl" id="brand-name" style="font-size: 18pt; font-weight: bold;">Magic Bean Games</h1>
          <p class="text-sm text-neutral-500" id="subtitle" style="font-size: 13pt; line-height: 40px;">2025 ESSEN SPIEL Preorder</p>
        </div>
      </div>

      <!-- Top-right: website & Instagram -->
<div id="headerLinks" class="absolute right-10 top-10 flex items-center gap-2">
  <!-- Homepage -->
  <a
    href="https://www.magicbeangames.com" target="_blank" rel="noopener"
    class="inline-flex items-center gap-2 rounded-xl border border-neutral-300 px-3 py-1.5 text-sm hover:bg-neutral-100"
    aria-label="Open website"
  >
    <!-- home icon -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
         class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 10.5 12 3l9 7.5" />
      <path d="M5 10.5V21h14V10.5" />
      <path d="M9 21v-6h6v6" />
    </svg>
    <span class="hidden sm:inline">Website</span>
  </a>

  <!-- Instagram -->
  <a
    href="https://www.instagram.com/magicbeangames" target="_blank" rel="noopener"
    class="inline-flex items-center gap-2 rounded-xl border border-neutral-300 px-3 py-1.5 text-sm hover:bg-neutral-100"
    aria-label="Open Instagram"
  >
    <!-- instagram icon -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
         class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="3" width="18" height="18" rx="5"></rect>
      <circle cx="12" cy="12" r="4"></circle>
      <circle cx="17" cy="7" r="1.2" fill="currentColor" stroke="none"></circle>
    </svg>
    <span class="hidden sm:inline">Instagram</span>
  </a>
</div>


      <!-- language selector removed for EN-only version -->
    </div>

  </header>

  <main class="max-w-5xl mx-auto px-4 py-8 grid lg:grid-cols-3 gap-6" style="margin-bottom: 40px;">
    <section class="lg:col-span-2">
      <p class="mb-6 text-neutral-600" id="intro">Preorder before ESSEN SPIEL. Choose quantities and leave your contact info.</p>
      <div id="catalog" class="grid sm:grid-cols-2 gap-4"></div>
    </section>

    <aside class="bg-white rounded-2xl shadow-sm border border-neutral-200 p-5 h-fit sticky top-20">
      <h2 class="text-lg font-semibold mb-3" id="review-title">Order Summary</h2>
      <div id="cart-list" class="space-y-2 max-h-56 overflow-auto pr-1 text-sm"></div>
      <div class="mt-3 pt-3 border-t border-neutral-200 flex items-center justify-between">
        <span class="text-sm text-neutral-600" id="label-total">Total</span>
        <span class="text-base font-semibold" id="total">€0.00</span>
      </div>

      <form id="order-form" class="mt-5 space-y-3">
        <div>
          <label class="block text-sm mb-1" id="label-name">Name</label>
          <input id="name" class="w-full px-3 py-2 rounded-xl border border-neutral-300" placeholder="Jane Doe" />
        </div>
        <div>
          <label class="block text-sm mb-1" id="label-email">Email</label>
          <input id="email" class="w-full px-3 py-2 rounded-xl border border-neutral-300" placeholder="you@example.com" />
        </div>
        <div>
          <label class="block text-sm mb-1" id="label-notes">Notes (optional)</label>
          <textarea id="notes" class="w-full px-3 py-2 rounded-xl border border-neutral-300 min-h-[80px]" placeholder="Pickup time / booth visit time, etc."></textarea>
        </div>
        <label class="flex items-start gap-2 text-sm">
          <input type="checkbox" class="mt-1" id="agree" />
          <span id="label-agree">I agree to the collection and use of my personal data.</span>
        </label>
        <label class="flex items-start gap-2 text-sm" style="margin-bottom: 20px;">
          <input type="checkbox" class="mt-1" id="agree" />
          <span id="label-agree">Please note that payment is accepted in <strong style="color: red; font-weight: normal;">EUR cash only</strong>, and kindly be aware that if you do not pick up by this date, the item may no longer be available.</span>
        </label>

        <div id="status" class="hidden text-sm rounded-xl p-2"></div>

        <button id="submit" type="submit" class="w-full py-3 rounded-2xl bg-neutral-900 text-white font-medium hover:bg-black">Place Order</button>

        <div class="flex gap-2">
          <button type="button" id="btn-csv" class="flex-1 py-2 rounded-xl border border-neutral-300 hover:bg-neutral-50">Download CSV</button>
          <button type="button" id="btn-mail" class="flex-1 py-2 rounded-xl border border-neutral-300 hover:bg-neutral-50" style="display: none;">Send by Email</button>
        </div>
        <p class="text-[11px] text-neutral-500 mt-1" id="pickup-hint">Pickup at ESSEN · Cash EUR</p>
      </form>
    </aside>
  </main>

    <!-- Accordion details section -->
    <section id="accordion" class="border-t border-neutral-200 bg-white/70">
    <div class="mx-auto px-4 py-10 w-full md:w-[85%] lg:w-[70%] max-w-[900px]" style="text-align: center;">
        <h2 class="text-xl font-semibold mb-4">Game Details (Photo)</h2>
        <p class="text-neutral-600 mb-4" style="margin-bottom: 50px;">Tap each title to view slides & description.</p>
        <div id="accordion-wrap" class="space-y-3"></div>
    </div>
    </section>

  <footer class="max-w-5xl mx-auto px-4 pb-10 pt-4 text-xs text-neutral-500">
    © <span id="year"></span> <span id="brand-foot">Magic Bean Games</span>. All rights reserved.
  </footer>

  <script>
    // ====== CONFIG (EN-only + Formspree) ======
    const CONFIG = {
      BRAND_NAME: 'Magic Bean Games',
      CURRENCY: 'EUR',
      ENDPOINT_URL: 'https://formspree.io/f/xldlzgan',
      CONTACT_EMAIL: 'order@magicbeangame.com',
      PRODUCTS: [
        { id: '001', name: 'Silla : Thousand-Year Smile', price: 30, image: 'https://ai.esmplus.com/magicbean7/Order/silla.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/silla01.jpg', 'https://ai.esmplus.com/magicbean7/Order/silla02.jpg', 'https://ai.esmplus.com/magicbean7/Order/silla05.png', 'https://ai.esmplus.com/magicbean7/Order/silla06.png', 'https://ai.esmplus.com/magicbean7/Order/silla03.png', 'https://ai.esmplus.com/magicbean7/Order/silla07.png', 'https://ai.esmplus.com/magicbean7/Order/silla08.png'] },
        { id: '002', name: 'Omok Chess : Hundred Years War', price: 20, image: 'https://ai.esmplus.com/magicbean7/Order/omokchess.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/omok02.png', 'https://ai.esmplus.com/magicbean7/Order/omok04.png', 'https://ai.esmplus.com/magicbean7/Order/omok03.png', 'https://ai.esmplus.com/magicbean7/Order/omok05.png', 'https://ai.esmplus.com/magicbean7/Order/omok06.png'] },
        { id: '003', name: 'Codetalk', price: 30, image: 'https://ai.esmplus.com/magicbean7/Order/codetalk.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/codetalk02.png', 'https://ai.esmplus.com/magicbean7/Order/codetalk01.png', 'https://ai.esmplus.com/magicbean7/Order/codetalk03.png', 'https://ai.esmplus.com/magicbean7/Order/codetalk04.png'] },
        { id: '004', name: 'Segongsa (Craftsman)', price: 25, image: 'https://ai.esmplus.com/magicbean7/Order/segongsa.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/segongsa02.png', 'https://ai.esmplus.com/magicbean7/Order/segongsa01.png', ''] },
        { id: '005', name: 'ShakeShake Tower', price: 15, image: 'https://ai.esmplus.com/magicbean7/Order/shaketower.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/shaketower01.png', 'https://ai.esmplus.com/magicbean7/Order/shaketower02.png', 'https://ai.esmplus.com/magicbean7/Order/shaketower03.png'] },
        { id: '006', name: 'Egg Add', price: 30, image: 'https://ai.esmplus.com/magicbean7/Order/eggadd.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/eggadd01.png', 'https://ai.esmplus.com/magicbean7/Order/eggadd02.png', 'https://ai.esmplus.com/magicbean7/Order/eggadd03.png'] },
        { id: '007', name: 'Hangeul Day', price: 30, image: 'https://ai.esmplus.com/magicbean7/Order/hanguelnal.png', 
        slides:['https://ai.esmplus.com/magicbean7/Order/hanguelnal01.png', 'https://ai.esmplus.com/magicbean7/Order/hanguelnal04.png', 'https://ai.esmplus.com/magicbean7/Order/hanguelnal02.png', 'https://ai.esmplus.com/magicbean7/Order/hanguelnal03.png'] },
        /*
        { id: 'MBG-009', name: 'DIY Card Kit A', price: 14, image: '' },
        { id: 'MBG-010', name: 'DIY Card Kit B', price: 14, image: '' },
         */
      ],
      TEXT: {
        intro: 'Preorder before ESSEN SPIEL. Choose quantities and leave your contact info.',
        name: 'Name', email: 'Email', notes: 'Notes (optional)', submit: 'Place Order', submitting: 'Submitting...',
        successTitle: 'Order received!', successBody: "We'll email a confirmation shortly. Pickup at ESSEN or as otherwise arranged.",
        errorTitle: 'Submission failed.', errorBody: 'Please try again, or use CSV download / email draft as a fallback.',
        total: 'Total', qty: 'Qty', price: 'Price', item: 'Item', review: 'Order Summary',
        pickup: 'Pickup at ESSEN', downloadCsv: 'Download CSV', emailDraft: 'Send by Email', emptyCart: 'No items selected.',
        required: 'This field is required.', emailInvalid: 'Please enter a valid email.'
      }
    };

    // ====== STATE ======
    let quantities = Object.fromEntries(CONFIG.PRODUCTS.map(p => [p.id, 0]));

    // ====== UTIL ======
    const $ = sel => document.querySelector(sel);
    const fmt = n => new Intl.NumberFormat('en-US', { style: 'currency', currency: CONFIG.CURRENCY }).format(n || 0);

    const itemsWithTotals = () => CONFIG.PRODUCTS.map(p => ({
      ...p,
      qty: Number(quantities[p.id] || 0),
      lineTotal: (Number(quantities[p.id] || 0) * (p.price || 0))
    }));
    const cartItems = () => itemsWithTotals().filter(i => i.qty > 0);
    const cartTotal = () => cartItems().reduce((s,i)=>s+i.lineTotal,0);

    function setQty(id, val){ const v = Math.max(0, Math.min(99, Number(val)||0)); quantities[id] = v; renderCart(); renderCatalogQtyOnly(); }

    function setStatus(kind, message){ const box=$('#status'); if(!kind){ box.className='hidden'; box.textContent=''; return;} box.className='text-sm rounded-xl p-2 '+(kind==='error'?'text-red-600 bg-red-50 border border-red-200':'text-green-700 bg-green-50 border border-green-200'); box.innerHTML=message; }

    function validate(name, email, agree){
      if(!name.trim()) return {ok:false, err: CONFIG.TEXT.required + ' ('+ CONFIG.TEXT.name +')'};
      if(!email.trim()) return {ok:false, err: CONFIG.TEXT.required + ' ('+ CONFIG.TEXT.email +')'};
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.trim())) return {ok:false, err: CONFIG.TEXT.emailInvalid};
      if(cartItems().length===0) return {ok:false, err: CONFIG.TEXT.emptyCart};
      if(!agree) return {ok:false, err: 'Please agree to the privacy policy.'};
      return {ok:true};
    }

    const payload = (name, email, notes) => ({
      brand: CONFIG.BRAND_NAME,
      language: 'en',
      name: name.trim(),
      email: email.trim(),
      notes: notes.trim(),
      total: cartTotal(),
      currency: CONFIG.CURRENCY,
      items: cartItems().map(c=>({id:c.id, name:c.name, qty:c.qty, unitPrice:c.price, lineTotal:c.lineTotal})),
      timestamp: new Date().toISOString(),
      pickup: true,
    });

// CSV: receipt-like layout (safe & neat)
function downloadCSV(name, email, notes){
  const p = payload(name, email, notes);

  // Escape for CSV + prevent formula injection
  const esc = (v) => {
    let s = String(v ?? '').replace(/\r?\n/g, ' ').trim();
    if (/^[=+\-@]/.test(s)) s = "'" + s;         // prevent formula eval
    if (s.includes('"')) s = s.replace(/"/g, '""');
    return (s.includes(',') ? `"${s}"` : s);
  };

  const now = new Date();
  const orderId = 'MB-' + now.toISOString().replace(/[-:T.Z]/g,'').slice(0,14);

  const lines = [];

  // Header block (receipt head)
  lines.push([`${CONFIG.BRAND_NAME} – ESSEN SPIEL Preorder`]);                    // title row (single cell)
  lines.push(['Order ID', orderId]);
  lines.push(['Date (ISO)', now.toISOString()]);
  lines.push(['Name', p.name]);
  lines.push(['Email', p.email]);
  if (p.notes) lines.push(['Notes', p.notes]);

  // Spacer
  lines.push([]);

  // Items table
  lines.push(['Item', 'Qty', `Unit (${CONFIG.CURRENCY})`, `Line (${CONFIG.CURRENCY})`]);
  (p.items.length ? p.items : [{name:'-', qty:'', unitPrice:'', lineTotal:''}]).forEach(i=>{
    lines.push([i.name, i.qty, i.unitPrice, i.lineTotal]);
  });

  // Spacer + total
  lines.push([]);
  lines.push(['Total', '', '', p.total]);

  // Build CSV
  const csv = lines
    .map(row => row.map(esc).join(','))
    .join('\r\n');

  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `preorder_receipt_${now.toISOString().slice(0,10)}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}
    function emailDraft(name, email, notes){ const p=payload(name,email,notes); const subject=encodeURIComponent(`[Preorder] ${p.name}`); const items=p.items.map(i=>`- ${i.name} x${i.qty} = ${fmt(i.lineTotal)}`).join('\n'); const body=encodeURIComponent(`Name: ${p.name}\nEmail: ${p.email}\nPickup: ${p.pickup?'Yes':'No'}\nTotal: ${fmt(p.total)} ${p.currency}\n\nItems:\n${items}`+(p.notes?`\n\nNotes:\n${p.notes}`:'')); window.location.href=`mailto:${CONFIG.CONTACT_EMAIL}?subject=${subject}&body=${body}`; }

    async function submitOrder(e){
      e.preventDefault();
      const name = $('#name').value || '';
      const email = $('#email').value || '';
      const notes = $('#notes').value || '';
      const agree = $('#agree').checked;
      

      const v = validate(name, email, agree);
      if(!v.ok){ setStatus('error', `${CONFIG.TEXT.errorTitle} <span class='text-neutral-500'>(${v.err})</span>`); return; }

      const p = payload(name, email, notes);
      if(!CONFIG.ENDPOINT_URL){ setStatus('success', `<div class='font-medium'>${CONFIG.TEXT.successTitle}</div><div class='text-neutral-600'>${CONFIG.TEXT.successBody}</div><div class='mt-2 text-neutral-600'>• ${CONFIG.TEXT.downloadCsv} / ${CONFIG.TEXT.emailDraft} available as fallback.</div>`); return; }

      $('#submit').disabled = true; $('#submit').textContent = CONFIG.TEXT.submitting;
      try{
        const res = await fetch(CONFIG.ENDPOINT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(p) });
        if(!res.ok) throw new Error('Network response was not ok');
        setStatus('success', `<div class='font-medium'>${CONFIG.TEXT.successTitle}</div><div class='text-neutral-600'>${CONFIG.TEXT.successBody}</div>`);
        quantities = Object.fromEntries(CONFIG.PRODUCTS.map(x=>[x.id,0])); $('#notes').value=''; $('#agree').checked = false; render();
      }catch(err){ setStatus('error', `${CONFIG.TEXT.errorTitle} <span class='text-neutral-500'>(${err.message||'submit failed'})</span><div class='text-neutral-600 mt-1'>${CONFIG.TEXT.errorBody}</div>`); }
      finally{ $('#submit').disabled = false; $('#submit').textContent = CONFIG.TEXT.submit; }
    }
    
    // ====== RENDER ======
    function renderCatalog(){ const wrap=$('#catalog'); wrap.innerHTML=''; itemsWithTotals().forEach(p=>{ const card=document.createElement('div'); card.className='bg-white rounded-2xl shadow-sm border border-neutral-200 p-4 flex gap-4'; card.innerHTML=`
      <div class="w-24 h-26 rounded-xl bg-neutral-100 border border-neutral-200 overflow-hidden flex items-center justify-center text-xs text-neutral-400">${p.image?`<img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover"/>`:'<span>No image</span>'}</div>
      <div class="flex-1 min-w-0" style="height:110px; position:relative;">
        <div class="flex items-start justify-between gap-3">
            <div class="flex-1 min-w-0">
                <h3 class="font-medium catalog-title leading-tight">${p.name}</h3>
                <p class="text-xs text-neutral-500" style="color:white;">${p.id}</p>
            </div>
            <div class="text-right shrink-0 min-w-[20px]">
                ${typeof p.price==='number'
                    ? `<div class='text-sm font-semibold'>${fmt(p.price)}</div>`
                    : `<div class='text-xs text-neutral-400'>${CONFIG.TEXT.price}: –</div>`}
            </div>
        </div>
        <div class="mt-3 flex items-center justify-between" style="position:absolute;  bottom:0; right:0;">
          <label class="text-sm text-neutral-600" style="color:white;">${CONFIG.TEXT.qty}</label>
          <div class="flex items-center gap-2">
            <button type="button" class="w-8 h-8 rounded-xl border border-neutral-300 hover:bg-neutral-100" aria-label="decrease" data-act="dec" data-id="${p.id}">−</button>
            <input inputmode="numeric" pattern="[0-9]*" type="number" min="0" max="99" class="w-16 text-center px-2 py-1.5 rounded-xl border border-neutral-300" value="${p.qty}" data-id="${p.id}" data-act="input"/>
            <button type="button" class="w-8 h-8 rounded-xl border border-neutral-300 hover:bg-neutral-100" aria-label="increase" data-act="inc" data-id="${p.id}">+</button>
          </div>
        </div>
      </div>`; wrap.appendChild(card); }); }

    function renderCatalogQtyOnly(){
      // Update only the qty inputs when changing quantities by buttons/typing
      document.querySelectorAll('input[data-act="input"]').forEach(inp=>{
        const id = inp.getAttribute('data-id');
        inp.value = quantities[id] || 0;
      });
      $('#total').textContent = fmt(cartTotal());
      const list=$('#cart-list'); list.innerHTML=''; const cart=cartItems(); if(cart.length===0){ list.innerHTML=`<div class='text-sm text-neutral-500'>${CONFIG.TEXT.emptyCart}</div>`; } cart.forEach(c=>{ const row=document.createElement('div'); row.className='flex items-center justify-between text-sm'; row.innerHTML=`<div class='truncate pr-2'>${c.name} × ${c.qty}</div><div class='shrink-0 font-medium'>${fmt(c.lineTotal)}</div>`; list.appendChild(row); });
    }

    function renderCart(){
      const list=$('#cart-list'); list.innerHTML=''; const cart=cartItems(); if(cart.length===0){ list.innerHTML=`<div class='text-sm text-neutral-500'>${CONFIG.TEXT.emptyCart}</div>`; } cart.forEach(c=>{ const row=document.createElement('div'); row.className='flex items-center justify-between text-sm'; row.innerHTML=`<div class='truncate pr-2'>${c.name} × ${c.qty}</div><div class='shrink-0 font-medium'>${fmt(c.lineTotal)}</div>`; list.appendChild(row); }); $('#total').textContent=fmt(cartTotal());
    }

    function renderTexts(){ $('#brand-name').textContent=CONFIG.BRAND_NAME; $('#brand-foot').textContent=CONFIG.BRAND_NAME; $('#subtitle').textContent='ESSEN SPIEL Preorder'; $('#intro').textContent=CONFIG.TEXT.intro; $('#review-title').textContent=CONFIG.TEXT.review; $('#label-total').textContent=CONFIG.TEXT.total; $('#label-name').textContent=CONFIG.TEXT.name; $('#label-email').textContent=CONFIG.TEXT.email; $('#label-notes').textContent=CONFIG.TEXT.notes; $('#label-agree').textContent='I agree to the collection and use of my personal data.'; $('#submit').textContent=CONFIG.TEXT.submit; $('#btn-csv').textContent=CONFIG.TEXT.downloadCsv; $('#btn-mail').textContent=CONFIG.TEXT.emailDraft; $('#pickup-hint').textContent=`${CONFIG.TEXT.pickup} · ${CONFIG.CURRENCY}`; $('#year').textContent=new Date().getFullYear(); setStatus(null); }

    function render(){ renderTexts(); renderCatalog(); renderCart(); }

    // ====== EVENTS ======
    document.addEventListener('click',(e)=>{ const a=e.target.getAttribute('data-act'); const id=e.target.getAttribute('data-id'); if(a==='inc') setQty(id,(quantities[id]||0)+1); if(a==='dec') setQty(id,(quantities[id]||0)-1); });
    document.addEventListener('input',(e)=>{ if(e.target.getAttribute('data-act')==='input'){ const id=e.target.getAttribute('data-id'); setQty(id,e.target.value); } });
    document.getElementById('order-form').addEventListener('submit', submitOrder);
    document.getElementById('btn-csv').addEventListener('click', ()=> downloadCSV($('#name').value||'', $('#email').value||'', $('#notes').value||''));
    document.getElementById('btn-mail').addEventListener('click', ()=> emailDraft($('#name').value||'', $('#email').value||'', $('#notes').value||''));

    // INIT
    render();
    renderAccordion();

    // ===== Slider helpers (for card-news style) =====
function setupSlider(root){
  if(!root) return;
  const track = root.querySelector('[data-track]');
  const dotsWrap = root.querySelector('[data-dots]');
  const thumbsWrap = root.querySelector('[data-thumbs]'); // ⭐ 추가: 썸네일 컨테이너
  const slides = Array.from(track.children);
  const count = slides.length;
  root._idx = 0; root._count = count;

  // Dots 생성
  if (dotsWrap) {
    dotsWrap.innerHTML = '';
    slides.forEach((_, i)=>{
      const b = document.createElement('button');
      b.type = 'button';
      b.setAttribute('data-dot-index', i);
      b.className = 'w-2.5 h-2.5 rounded-full bg-neutral-300 aria-[current=true]:bg-neutral-900';
      if(i===0) b.setAttribute('aria-current','true');
      dotsWrap.appendChild(b);
    });
  }
  // ⭐ 추가: 썸네일 생성
  if (thumbsWrap) {
    thumbsWrap.innerHTML = '';
    slides.forEach((slide, i) => {
      const img = slide.querySelector('img');
      const src = img ? img.getAttribute('src') : '';
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.setAttribute('data-thumb-index', i);
      btn.className =
        'relative w-16 h-16 rounded-lg overflow-hidden border ' +
        'border-transparent focus:outline-none aria-[current=true]:border-neutral-900';
      if (i === 0) btn.setAttribute('aria-current', 'true');

      btn.innerHTML = src
        ? `<img src="${src}" alt="thumbnail ${i+1}" class="w-full h-full object-cover" loading="lazy" />`
        : `<div class="w-full h-full bg-neutral-100 flex items-center justify-center text-[10px] text-neutral-400">No image</div>`;

      thumbsWrap.appendChild(btn);
    });
  }

  function syncIndicators(){
    if (dotsWrap) {
      dotsWrap.querySelectorAll('[data-dot-index]').forEach((d, di)=>{
        if(di===root._idx) d.setAttribute('aria-current','true');
        else d.removeAttribute('aria-current');
      });
    }
    if (thumbsWrap) {
      thumbsWrap.querySelectorAll('[data-thumb-index]').forEach((t, ti)=>{
        if(ti===root._idx) t.setAttribute('aria-current','true');
        else t.removeAttribute('aria-current');
      });
    }
  }

  function goTo(i){
    if(count===0) return;
    root._idx = (i+count)%count;
    track.style.transform = `translateX(-${root._idx * 100}%)`;
    syncIndicators();
  }

  root.querySelector('[data-prev]')?.addEventListener('click', ()=> goTo(root._idx - 1));
  root.querySelector('[data-next]')?.addEventListener('click', ()=> goTo(root._idx + 1));
  if (dotsWrap) {
    dotsWrap.addEventListener('click', (e)=>{
      const dot = e.target.closest('[data-dot-index]');
      if(dot) goTo(Number(dot.getAttribute('data-dot-index')));
    });
  }

  // ⭐ 추가: 썸네일 클릭 이동
  if (thumbsWrap) {
    thumbsWrap.addEventListener('click', (e)=>{
      const th = e.target.closest('[data-thumb-index]');
      if(th) goTo(Number(th.getAttribute('data-thumb-index')));
    });
  }

  // Swipe 지원
  let startX = 0, dx = 0, dragging = false;
  const viewport = root.querySelector('[data-viewport]');
  viewport.addEventListener('pointerdown', (e)=>{ dragging=true; startX=e.clientX; dx=0; viewport.setPointerCapture(e.pointerId); });
  viewport.addEventListener('pointermove', (e)=>{ if(!dragging) return; dx = e.clientX - startX; });
  viewport.addEventListener('pointerup', ()=>{ if(!dragging) return; dragging=false; if(Math.abs(dx)>40){ if(dx<0) goTo(root._idx+1); else goTo(root._idx-1); } dx=0; });

  goTo(0);
}

// ===== Accordion renderer =====
function renderAccordion(){
  const root = document.getElementById('accordion-wrap');
  if(!root) return;
  root.innerHTML = '';

  CONFIG.PRODUCTS.forEach((p) => {
    const pid = `acc-${p.id}`;
    const sliderId = `slider-${p.id}`;
    // ⬇️ 추가: <br> 제거 후 한 줄 문자열로 정리
const oneLineName = String(p.name || '')
  .replace(/<\s*br\s*\/?>/gi, ' ')   // <br> -> 공백
  .replace(/\s+/g, ' ')              // 공백 정리
  .trim();
    // slides 배열이 있으면 사용, 없으면 image 한 장만 사용
    const slides = (Array.isArray(p.slides) && p.slides.length) ? p.slides : (p.image ? [p.image] : []);
    const slidesHTML = slides.length ? slides.map(src => `
      <div class="w-full shrink-0 h-72 sm:h-80 md:h-96 bg-neutral-100 flex items-center justify-center border border-neutral-200">
        <img src="${src}" alt="${p.name}" class="w-full h-full object-cover"/>
      </div>`).join('') : `
      <div class="w-full shrink-0 h-72 sm:h-80 md:h-96 bg-neutral-100 flex items-center justify-center border border-neutral-200 text-xs text-neutral-400">
        No image
      </div>`;

    const item = document.createElement('div');
item.className = 'border border-neutral-200 rounded-2xl bg-white shadow-sm';
item.innerHTML = `
  <h3>
    <button type="button" data-acc-btn aria-expanded="false" aria-controls="${pid}" class="w-full flex items-center justify-between gap-3 p-4">
      <span class="text-left">
        <span class="block font-medium whitespace-nowrap truncate" data-title></span>
        <span class="block text-xs text-neutral-500" style="color:white;">${p.id}</span>
      </span>
      <span class="ml-4 text-xl select-none" data-acc-indicator aria-hidden="true">+</span>
    </button>
  </h3>
  <div id="${pid}" role="region" hidden class="px-4 pb-4">
    <div id="${sliderId}" data-slider-root class="relative">
      <div data-viewport class="overflow-hidden rounded-xl">
        <div data-track class="flex transition-transform duration-300 ease-out">
          ${slidesHTML}
        </div>
      </div>

      <button type="button" data-prev class="absolute left-2 top-1/2 -translate-y-1/2 w-9 h-9 rounded-full border border-neutral-300 bg-white/90 backdrop-blur flex items-center justify-center text-lg" aria-label="Previous slide">‹</button>
      <button type="button" data-next class="absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 rounded-full border border-neutral-300 bg-white/90 backdrop-blur flex items-center justify-center text-lg" aria-label="Next slide">›</button>

      <div class="mt-3 flex items-center justify-center gap-2">
        <div data-dots class="flex items-center justify-center gap-2"></div>
      </div>

      <!-- 썸네일 리스트 -->
      <div data-thumbs class="mt-3 flex justify-center gap-2"></div>
    </div>

    <div class="mt-3 flex items-center justify-between">
      <div class="text-sm text-neutral-600"></div>
    </div>
    <p class="text-sm text-neutral-700 mt-2">${p.desc || ''}</p>
  </div>`;

    root.appendChild(item);
    item.querySelector('[data-title]').textContent = oneLineName;
    
    

    // Initialize slider after insertion
    const sliderRoot = item.querySelector('#'+sliderId);
    setupSlider(sliderRoot);
  });
}


// Accordion: single-open behavior (open one, close others)
document.addEventListener('click', (e) => {
  const btn = e.target.closest('[data-acc-btn]');
  if (!btn) return;

  // 아코디언 영역 안에서만 동작 (여러 개 있어도 안전)
  const wrap = document.getElementById('accordion-wrap');
  if (!wrap || !wrap.contains(btn)) return;

  const targetId = btn.getAttribute('aria-controls');
  const targetPanel = document.getElementById(targetId);
  const willOpen = btn.getAttribute('aria-expanded') !== 'true';

  // 1) 전부 닫기
  wrap.querySelectorAll('[data-acc-btn]').forEach(b => {
    b.setAttribute('aria-expanded', 'false');
    const pid = b.getAttribute('aria-controls');
    const p = document.getElementById(pid);
    if (p) p.hidden = true;
    const ind = b.querySelector('[data-acc-indicator]');
    if (ind) ind.textContent = '+';
  });

  // 2) 방금 클릭한 것만 열기(이미 열려있던 걸 누르면 모두 닫힌 상태가 됨)
  if (willOpen) {
    btn.setAttribute('aria-expanded', 'true');
    if (targetPanel) targetPanel.hidden = false;
    const ind = btn.querySelector('[data-acc-indicator]');
    if (ind) ind.textContent = '−';
  }
});
    
// ===== Header shrink on scroll (mobile) =====
function applyHeaderShrink() {
  const y = window.scrollY || document.documentElement.scrollTop || 0;
  const header = document.getElementById('siteHeader');
  if (!header) return;
  if (y > 20) header.classList.add('shrink');
  else header.classList.remove('shrink');
}
window.addEventListener('scroll', applyHeaderShrink, { passive: true });
window.addEventListener('load', applyHeaderShrink);
  </script>
</body>
</html>
